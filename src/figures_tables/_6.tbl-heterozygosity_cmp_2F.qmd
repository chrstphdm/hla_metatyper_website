---
title: ""
execute:
  echo: false
jupyter: python3
output: word_document
cap-location: bottom
format: 
  html:
    page-layout: full
  pdf:
    pdf-engine: lualatex
    fontsize: 12pt
    mainfont: Open Sans
    sansfont: Open Sans
    # classoption: landscape
    pagestyle: empty
    include-in-header: 
      text: |
        \usepackage[top=0.5mm, left=10mm, right=10mm, bottom=0.5mm]{geometry}
        \usepackage{lscape}
        \newcommand{\blandscape}{\begin{landscape}}
        \newcommand{\elandscape}{\end{landscape}}
  
---

```{python}
#| label: tbl-heterozygosity_cmp_2F
#| tbl-cap: Comparison of homozigosity percentage for each typer (**results DOWNSCALED to 2 fields**). Genes DRB[2345] have been ignored, as well as the genes that have not been typed by the 3 algorithms.
#| 
import pandas
import numpy as np
from IPython.display import Markdown, display
def printmd(string):
    display(Markdown(string))

def heterozygosity_cmp_2F():

  rez = pandas.read_csv('data/OUTPUT/5.N_1_RESULTS/all_results-2F-filtered.csv')
  genes_list = sorted(rez.gene.unique().tolist())
  markdown_text="| Gene | HISAT-genotype homozigosity (%) | HLA-HD homozigosity (%) | T1K homozigosity (%) |\n"
  markdown_text+="| --- | --- | --- | --- |\n"

  df_hetero = pandas.DataFrame(columns=["hisat_htz","hlahd_htz","t1k_htz"])
  df_hetero = df_hetero.astype( dtype={"hisat_htz" : float,"hlahd_htz" : float,"t1k_htz" : float})

  for n,gene in enumerate(genes_list ):
    if gene in ["DRB2","DRB3","DRB4","DRB5"]:
      continue

    rez_het_cmp = rez.query("gene == @gene").loc[(rez['filter_int'] == 0)]

    hisat_results_het_cmp = rez_het_cmp.loc[(rez_het_cmp['hlahd_nbreads1'] >= 10) & (rez_het_cmp['hlahd_sum_reads'] >= 20 )]
    hlahd_results_het_cmp = rez_het_cmp.loc[(rez_het_cmp['hisat_abundance2'] >= rez_het_cmp['hisat_abundance1']/10)]
    t1k_results_het_cmp = rez_het_cmp.loc[~rez_het_cmp['t1k_genotype'].isna()]

    ## nb available calls
    nb_calls_all_hisat_results_het_cmp = hisat_results_het_cmp.shape[0]
    nb_calls_all_hlahd_results_het_cmp = hlahd_results_het_cmp.shape[0]
    nb_calls_all_t1k_results_het_cmp = t1k_results_het_cmp.shape[0]

    if nb_calls_all_hisat_results_het_cmp == 0 or nb_calls_all_hlahd_results_het_cmp == 0 or nb_calls_all_t1k_results_het_cmp == 0:
      continue

    ## percentage of homozigosity
    percentage_calls_hisat_hmz =  hisat_results_het_cmp.loc[hisat_results_het_cmp['hisat_genotype'] == 'Hmz'].shape[0]/nb_calls_all_hisat_results_het_cmp*100 
    percentage_calls_hlahd_hmz =  hlahd_results_het_cmp.loc[hlahd_results_het_cmp['hlahd_genotype'] == 'Hmz'].shape[0]/nb_calls_all_hlahd_results_het_cmp*100 
    percentage_calls_t1k_hmz =  t1k_results_het_cmp.loc[t1k_results_het_cmp['t1k_genotype'] == 'Hmz'].shape[0]/nb_calls_all_t1k_results_het_cmp*100
    
    markdown_text+=f"|{gene}|{percentage_calls_hisat_hmz:.2f}|{percentage_calls_hlahd_hmz:.2f}|{percentage_calls_t1k_hmz:.2f}|\n"
    df_hetero.loc[gene] = [percentage_calls_hisat_hmz, percentage_calls_hlahd_hmz,percentage_calls_t1k_hmz]
  printmd(markdown_text)

heterozygosity_cmp_2F()
```